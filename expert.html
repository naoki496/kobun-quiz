<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>古文単語330 | EXPERT</title>
  <link rel="stylesheet" href="./styles.css" />
  <link rel="stylesheet" href="./expert.css" />
</head>

<body>
  <div class="bg"></div>

  <main class="wrap" id="app">
    <header class="topbar">
      <div class="brand">
        <div class="mode">EXPERT</div>
        
      </div>

      <div class="topActions">
        <!-- ✅ BGM button: prominent -->
        <button class="bgmBtn" id="btnBgm" type="button" aria-pressed="true" title="BGM切替">
          <span class="bgmDot" aria-hidden="true"></span>
          <span class="bgmText">BGM: ON</span>
        </button>

        <div class="hud">
          <div class="hudItem">
            <div class="hudLabel">Q</div>
            <div class="hudValue" id="hudQ">--/30</div>
          </div>
          <div class="hudItem">
            <div class="hudLabel">正解</div>
            <div class="hudValue" id="hudCorrect">0</div>
          </div>
          <div class="hudItem">
            <div class="hudLabel">COMBO</div>
            <div class="hudValue combo" id="hudCombo">0</div>
          </div>
          <div class="hudItem">
            <div class="hudLabel">MAX</div>
            <div class="hudValue" id="hudMaxCombo">0</div>
          </div>
        </div>
      </div>
    </header>

    <section class="panel">
      <div class="meterArea" id="meterArea"></div>

      <div class="questionBox">
        <div class="source" id="source"></div>
        <div class="question" id="question">読み込み中…</div>
      </div>

      <div class="choices" id="choices"></div>

      <div class="actions">
        <button class="btn ghost" id="btnRetry" type="button">リトライ</button>
        <a class="btn ghost" href="./index.html">戻る</a>
        <div class="note" id="note">音：ON（STARTで再生開始）</div>
      </div>
    </section>

    <!-- ✅ START modal -->
    <section class="overlay" id="startOverlay" aria-modal="true" role="dialog">
      <div class="overlayCard startCard" id="startCard">
        <div class="startBody">
          で<br/>
            <strong>★5カード<div class="emLine">入場料：<b>3HKP</b>（START時に消費）</div>
          </p>
          <p class="startQ">準備はできましたか？</p>
        </div>

        <!-- ===== EXPERT ENTRY GATE (enhanced) ===== -->
        <section class="gate" id="gate" aria-label="EXPERT入場ゲート">
          <div class="gateTop">
            <div class="gateTitle">EXPERT ENTRY</div>
            <div class="gateTag">挑戦契約</div>
          </div>

          <div class="gateBadges" aria-hidden="true">
            <span class="badge b-hkp">HKP SPEND</span>
            <span class="badge b-sound">SOUND ON</span>
            <span class="badge b-hard">HARD MODE</span>
          </div>

          <div class="gatePills">
            <div class="pill">消費 <b id="hkpCost">3</b> HKP</div>
            <div class="pill">所持 <b id="hkpNow">0</b> HKP</div>
          </div>

          <div class="gateMsg" id="gateMsg" aria-live="polite"></div>

          <div class="gateRules">
            <div class="ruleItem">STARTで <b>即時にHKPを消費</b>（途中離脱でも返却されません）</div>
            <div class="ruleItem">BGMが鳴ります（<b>音量注意</b>）</div>
            <div class="ruleItem">成功条件：正解 <b>25+</b> ＆ MAX COMBO <b>5+
          </div>
        </section>
        
        <div class="startActions">
          <button class="btn" id="btnStart" type="button">START</button>
        </div>
      </div>
    </section>

    <!-- RESULT overlay -->
    <section class="overlay hidden" id="overlay">
      <div class="overlayCard">
        <div class="resultTitle" id="resultTitle">RESULT</div>

        <div class="resultGrid">
          <div class="resultStat">
            <div class="k">正解</div><div class="v" id="rCorrect">0</div>
          </div>
          <div class="resultStat">
            <div class="k">MAX COMBO</div><div class="v" id="rMaxCombo">0</div>
          </div>
          <div class="resultStat">
            <div class="k">報酬</div><div class="v" id="rReward">-</div>
          </div>
        </div>

        <div class="cardArea hidden" id="cardArea">
          <div class="cardFrame" id="cardFrame">
            <img id="cardImg" alt="card" />
          </div>
          <div class="cardMeta">
            <div class="cardName" id="cardName"></div>
            <a class="cardWiki" id="cardWiki" target="_blank" rel="noopener">Wiki</a>
          </div>
        </div>

        <div class="resultActions">
          <button class="btn" id="btnAgain" type="button">もう一度（EXPERT）</button>
          <a class="btn ghost" href="./index.html">TOPへ</a>
        </div>
      </div>
    </section>

    <section class="countdown hidden" id="countdown"></section>
  </main>

  <!-- ✅ 重要：順番は必ず csv.js → expert.js -->
  <script src="./csv.js"></script>
  <script src="./expert.js"></script>
</body>
</html>
